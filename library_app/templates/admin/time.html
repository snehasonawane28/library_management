{% extends "admin/change_form.html" %}
{% load i18n admin_urls static admin_modify %}

{% block extrahead %}
{{ block.super }}
<script type="text/javascript" src="{% static 'admin/js/calendar.js' %}"></script>
<script type="text/javascript" src="{% static 'admin/js/admin/DateTimeShortcuts.js' %}"></script>
<script type="text/javascript">
    // Override the time format to 12-hour with AM/PM
    DateTimeShortcuts.time_format = 'g:i A';
    
    // Set date format to show full month name, day, year
    DateTimeShortcuts.date_format = 'N j, Y';
    
    // Override the formatTime function to ensure 12-hour format
    const oldFormatTime = DateTimeShortcuts.formatTime;
    DateTimeShortcuts.formatTime = function(timeString) {
        if (!timeString) return '';
        const timeParts = timeString.split(':');
        if (timeParts.length >= 2) {
            let hours = parseInt(timeParts[0]);
            const minutes = timeParts[1];
            const ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12;
            hours = hours ? hours : 12; // Convert 0 to 12 for 12 AM
            return hours + ':' + minutes + ' ' + ampm;
        }
        return timeString;
    };
    
    // Handle both date and time fields
    document.addEventListener('DOMContentLoaded', function() {
        // Format time inputs
        const timeInputs = document.querySelectorAll('input.vTimeField');
        timeInputs.forEach(function(input) {
            if (input.value) {
                const timeMatch = input.value.match(/(\d{1,2}):(\d{2})(?::\d{2})?(?:\s*([AP]M))?/i);
                if (timeMatch) {
                    let hours = parseInt(timeMatch[1]);
                    const minutes = timeMatch[2];
                    const ampm = timeMatch[3] || (hours >= 12 ? 'PM' : 'AM');
                    hours = hours % 12;
                    hours = hours ? hours : 12; // Convert 0 to 12 for 12 AM
                    input.value = hours + ':' + minutes + ' ' + ampm;
                }
            }
        });
        
        // Format date inputs
        const dateInputs = document.querySelectorAll('input.vDateField');
        dateInputs.forEach(function(input) {
            if (input.value) {
                const date = new Date(input.value);
                if (!isNaN(date.getTime())) {
                    const options = { year: 'numeric', month: 'short', day: 'numeric' };
                    input.value = date.toLocaleDateString(undefined, options);
                }
            }
        });
    });
</script>
{% endblock %}
                    const minutes = timeParts[1];
                    const ampm = hours >= 12 ? 'PM' : 'AM';
                    hours = hours % 12;
                    hours = hours ? hours : 12; // Convert 0 to 12 for 12 AM
                    input.value = hours + ':' + minutes + ' ' + ampm;
                }
            }
        });
    });
</script>
{% endblock %}
